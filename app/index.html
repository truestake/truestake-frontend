<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Truestake Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      html, body { height:100%; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;}
      body { background:#0e0f12; color:#fff; }
      .wrap { max-width: 720px; margin: 0 auto; padding: 16px; }
      .card { background: rgba(255,255,255,0.06); border-radius: 14px; padding: 16px; margin: 12px 0; }
      .row { display:flex; gap:12px; flex-wrap:wrap; }
      button { padding:12px 16px; border-radius:12px; border:0; background:#2b84ff; color:#fff; font-weight:600; }
      pre { white-space: pre-wrap; word-break: break-word; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h2>Truestake Mini App</h2>

      <div class="card" id="userCard">
        <div><b>User</b></div>
        <div id="userInfo">Loading…</div>
      </div>

      <div class="card">
        <div class="row">
          <button id="pingApi">Ping API</button>
          <button id="closeApp">Close</button>
        </div>
      </div>

      <div class="card">
        <div><b>initData</b></div>
        <pre id="initData"></pre>
      </div>
    </div>

    <script>
      const tg = window.Telegram?.WebApp;

      // Инициализация Telegram Mini App
      tg?.ready();
      try { tg?.expand(); } catch(e) {}
      try { tg?.setHeaderColor("#000000"); } catch(e) {}
      try { tg?.setBackgroundColor("#0e0f12"); } catch(e) {}
      try { tg?.enableClosingConfirmation(); } catch(e) {}

      // Тёмная тема по умолчанию
      try { tg?.setThemeParams({}) } catch(e) {}

      // Отображение пользователя
      const u = tg?.initDataUnsafe?.user;
      document.getElementById("userInfo").textContent =
        u ? `${u.first_name || ""} ${u.last_name || ""} (@${u.username || "-"})` : "unknown";

      // Покажем сырой initData (для дебага)
      document.getElementById("initData").textContent = tg?.initData || "(empty)";

      // Кнопки
      document.getElementById("closeApp").onclick = () => {
        try { tg.close(); } catch(e) { alert("close not available"); }
      };

      document.getElementById("pingApi").onclick = async () => {
        try {
          const r = await fetch("https://api.corsarinc.ru/");
          const j = await r.json();
          alert("API: " + JSON.stringify(j));
        } catch (e) {
          alert("API error: " + e);
        }
      };
    </script>
  </body>
</html>
